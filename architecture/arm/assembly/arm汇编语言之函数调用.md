# 前言
在之前看书的时候就已经接触过这方面的内容，所以大体上知道一些，但之前接触的时候只是被动接收，且没有动手实际操作过，只觉得好像还挺复杂的。这次因为一些原因，我必须得好好解析这部分了😅.

```ad-tip
c语言的函数被翻译成汇编是什么样的 ==> The ABI for ARM 64-bit Architecture
```

# 目标
首先我先定义一个本文需要去解决的问题或者要达到的目标:
> 能够解释 "c代码编译后的汇编(主要是函数之间的调用)" 

# 方法
仍然采取我最喜欢的方法 --> <mark style="background: #BBFABBA6;">自底向上</mark>
首先是对一篇材料的翻译，然后我会时不时的跳出来，去思考这到底是怎么回事，最后总结。

当不清楚一些背景的时候，会觉得很难，这时候就越要去思考为什么会这样，想通了之后就简单了。

当程序被编译成二进制的时候，放到内存中，然后开始从程序的入口出开始一条一条的执行，这就是当前脑海中的一个初始状态，接下来就开始解析 函数对应的指令是怎么回事。

# arm汇编之函数调用
原文: https://www.cs.princeton.edu/courses/archive/spr11/cos217/lectures/15AssemblyFunctions.pdf

## 课程目标
- 函数调用问题
	- 调用和返回
	- 参数传递
	- 保存局部变量
	- 没有影响的使用寄存器
	- 返回值
- IA-32的解决办法
	- 想关的指令和约定

```ad-tip
没错，这个是一个课件。这符合自下而上的思想，看看制作课件的老师是想要如何一步一步的介绍这些内容的
```

<mark style="background: #FFF3A3A6;">注：这篇内容是需要有一点点汇编基础的，就是大概知道mov和add是干啥的就好了，其余的不清楚的遇到再去了解就好。</mark>

### 阶段思考

> 这里需要总结一下，我没有想到上面课程目标中的 `函数调用问题` ，只是我的惯性了，以此告诫自己，这就是一个再去了解新东西之前应该思考的内容，举一反三，以后应该先做这些思考然后再去了解。

## 问题一：调用和返回
1. 调用函数（caller funciotn）是如何跳转到被调用函数（callee）的？
	亦即，跳转到被调用函数的第一条指令执行的地方。

2. 如何从被调用函数返回到调用函数的正确的地址上？
	亦即，跳转到调用函数 <mark style="background: #FFB86CA6;">最近刚执行的指令</mark> 下面 <mark style="background: #FFB86CA6;">立即要执行</mark> 的 指令。

```ad-note
1. 注意前面提到的初始状态，可执行程序在内存中就是一条一条指令，当然这里说的是代码段区域。
2. 像操作系统最开始的代码就是用汇编语句写的，之前在 李忠先生 的汇编语言书籍中看到过一些用汇编语言去实现一些功能。
3. 实际一个函数就是 一坨连续的指令，从一坨指令跳转到另一坨指令，然后再跳转回来，这是这个问题想要去讲清楚的地方。
4. 一坨指令可以使用 CPU 的寄存器资源，这里面需要特别注意的是 sp， 也就是栈，函数是有栈的。CPU 的这些寄存器资源只有一套，在使用的时候要考虑是否要保存当前的值，考虑当前的值是否会被其他地方用到。
```

### 调用和返回的尝试解决方案
- 使用跳转指令
![](https://raw.githubusercontent.com/later-3/blog-img/main/20221106171631.png)



